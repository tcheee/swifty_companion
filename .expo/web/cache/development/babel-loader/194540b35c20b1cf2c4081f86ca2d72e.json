{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/tche/Documents/swifty_companion/screens/selectUser.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport { ImageBackgroundBase } from \"react-native-web/dist/index\";\nimport { globalStyles } from \"../styles/global\";\nimport { MaterialIcons } from '@expo/vector-icons';\nimport Card from \"../shared/card\";\nimport { TextInput, ActivityIndicator, Colors } from 'react-native-paper';\nimport FlatButton from \"../shared/button.js\";\nexport default function Home(_ref) {\n  var navigation = _ref.navigation;\n  var code = navigation.getParam('code');\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      login = _useState2[0],\n      setLogin = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      token = _useState4[0],\n      setToken = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var POST_body = {\n    'grant_type': 'authorization_code',\n    'client_id': 'c0d296f87ad3d2fd9c1980da5f055fb4ee7fae41830be1f5d6985bea22b84a36',\n    'client_secret': '4631186c7cc1a5c7d206310ab2c04af3168cc0f41789173160cebaab61588233',\n    'code': code,\n    'redirect_uri': 'exp://10.18.205.228:19000'\n  };\n\n  var getUserInfoFrom42API = function getUserInfoFrom42API(token, user_id) {\n    var get_url;\n    return _regeneratorRuntime.async(function getUserInfoFrom42API$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            get_url = 'https://api.intra.42.fr/v2/users/' + user_id;\n            return _context2.abrupt(\"return\", new Promise(function _callee(resolve, reject) {\n              var response, json;\n              return _regeneratorRuntime.async(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _context.next = 3;\n                      return _regeneratorRuntime.awrap(fetch(get_url, {\n                        method: \"GET\",\n                        headers: new Headers({\n                          'Authorization': 'Bearer ' + token,\n                          'Content-Type': 'application/json'\n                        })\n                      }));\n\n                    case 3:\n                      response = _context.sent;\n                      _context.next = 6;\n                      return _regeneratorRuntime.awrap(response.json());\n\n                    case 6:\n                      json = _context.sent;\n                      resolve(json);\n                      _context.next = 14;\n                      break;\n\n                    case 10:\n                      _context.prev = 10;\n                      _context.t0 = _context[\"catch\"](0);\n                      console.error(_context.t0);\n                      reject(_context.t0);\n\n                    case 14:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, null, null, [[0, 10]], Promise);\n            }));\n\n          case 2:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getUserIdFrom42API = function getUserIdFrom42API(token) {\n    var filter, get_url;\n    return _regeneratorRuntime.async(function getUserIdFrom42API$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            filter = login.toLowerCase();\n            filter = filter.trim();\n            get_url = 'https://api.intra.42.fr/v2/users?filter[login]=' + filter;\n            return _context4.abrupt(\"return\", new Promise(function _callee2(resolve, reject) {\n              var response, json;\n              return _regeneratorRuntime.async(function _callee2$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      _context3.prev = 0;\n                      _context3.next = 3;\n                      return _regeneratorRuntime.awrap(fetch(get_url, {\n                        method: \"GET\",\n                        headers: new Headers({\n                          'Authorization': 'Bearer ' + token,\n                          'Content-Type': 'application/json'\n                        })\n                      }));\n\n                    case 3:\n                      response = _context3.sent;\n                      _context3.next = 6;\n                      return _regeneratorRuntime.awrap(response.json());\n\n                    case 6:\n                      json = _context3.sent;\n                      resolve(json);\n                      _context3.next = 14;\n                      break;\n\n                    case 10:\n                      _context3.prev = 10;\n                      _context3.t0 = _context3[\"catch\"](0);\n                      console.error(_context3.t0);\n                      reject(_context3.t0);\n\n                    case 14:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, null, null, [[0, 10]], Promise);\n            }));\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getTokenFrom42API = function getTokenFrom42API() {\n    return new Promise(function _callee3(resolve, reject) {\n      var response, json;\n      return _regeneratorRuntime.async(function _callee3$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return _regeneratorRuntime.awrap(fetch('https://api.intra.42.fr/oauth/token', {\n                method: \"POST\",\n                body: JSON.stringify(POST_body),\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              }));\n\n            case 3:\n              response = _context5.sent;\n              _context5.next = 6;\n              return _regeneratorRuntime.awrap(response.json());\n\n            case 6:\n              json = _context5.sent;\n              resolve(json.access_token);\n              _context5.next = 14;\n              break;\n\n            case 10:\n              _context5.prev = 10;\n              _context5.t0 = _context5[\"catch\"](0);\n              console.log(_context5.t0);\n              reject(_context5.t0);\n\n            case 14:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, [[0, 10]], Promise);\n    });\n  };\n\n  var getTokenInfo = function getTokenInfo(token) {\n    return new Promise(function _callee4(resolve, reject) {\n      var response, json;\n      return _regeneratorRuntime.async(function _callee4$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 3;\n              return _regeneratorRuntime.awrap(fetch('https://api.intra.42.fr/oauth/token/info', {\n                method: \"GET\",\n                headers: new Headers({\n                  'Authorization': 'Bearer ' + token,\n                  'Content-Type': 'application/json'\n                })\n              }));\n\n            case 3:\n              response = _context6.sent;\n              _context6.next = 6;\n              return _regeneratorRuntime.awrap(response.json());\n\n            case 6:\n              json = _context6.sent;\n              console.log(json);\n              resolve(json);\n              _context6.next = 15;\n              break;\n\n            case 11:\n              _context6.prev = 11;\n              _context6.t0 = _context6[\"catch\"](0);\n              console.error(_context6.t0);\n              reject(_context6.t0);\n\n            case 15:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, null, [[0, 11]], Promise);\n    });\n  };\n\n  var verifyToken = function verifyToken() {\n    return new Promise(function _callee5(resolve, reject) {\n      var check, new_token;\n      return _regeneratorRuntime.async(function _callee5$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.prev = 0;\n\n              if (!(token != '')) {\n                _context7.next = 9;\n                break;\n              }\n\n              console.log(token);\n              _context7.next = 5;\n              return _regeneratorRuntime.awrap(getTokenInfo(token));\n\n            case 5:\n              check = _context7.sent;\n              resolve(token);\n              _context7.next = 14;\n              break;\n\n            case 9:\n              _context7.next = 11;\n              return _regeneratorRuntime.awrap(getTokenFrom42API());\n\n            case 11:\n              new_token = _context7.sent;\n              setToken(new_token);\n              resolve(new_token);\n\n            case 14:\n              resolve(0);\n              _context7.next = 21;\n              break;\n\n            case 17:\n              _context7.prev = 17;\n              _context7.t0 = _context7[\"catch\"](0);\n              console.log(_context7.t0);\n              reject(-1);\n\n            case 21:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, null, null, [[0, 17]], Promise);\n    });\n  };\n\n  var handleSubmit = function handleSubmit() {\n    var _token, user, user_id, info;\n\n    return _regeneratorRuntime.async(function handleSubmit$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            if (!(login != '')) {\n              _context8.next = 15;\n              break;\n            }\n\n            setIsLoading(true);\n            _context8.next = 4;\n            return _regeneratorRuntime.awrap(verifyToken());\n\n          case 4:\n            _token = _context8.sent;\n            _context8.next = 7;\n            return _regeneratorRuntime.awrap(getUserIdFrom42API(_token));\n\n          case 7:\n            user = _context8.sent;\n            user_id = user[0].id;\n            console.log(isLoading);\n            _context8.next = 12;\n            return _regeneratorRuntime.awrap(getUserInfoFrom42API(_token, user_id));\n\n          case 12:\n            info = _context8.sent;\n            setIsLoading(false);\n            navigation.navigate('ReviewDetails', {\n              login: login,\n              userInfo: info\n            });\n\n          case 15:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(ImageBackground, {\n    source: require(\"../assets/background.jpeg\"),\n    style: styles.background,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 5\n    }\n  }, React.createElement(View, {\n    style: globalStyles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, React.createElement(TextInput, {\n    label: \"Login\",\n    onChangeText: setLogin,\n    value: login,\n    style: styles.textInput,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }\n  }), React.createElement(FlatButton, {\n    onPress: handleSubmit,\n    text: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  })));\n}\nvar styles = StyleSheet.create({\n  background: {\n    width: '100%',\n    height: '100%'\n  },\n  textInput: {\n    marginTop: 150,\n    marginBottom: 10,\n    backgroundColor: \"#E7F0FE\"\n  }\n});","map":{"version":3,"sources":["/Users/tche/Documents/swifty_companion/screens/selectUser.js"],"names":["React","useState","ImageBackgroundBase","globalStyles","MaterialIcons","Card","TextInput","ActivityIndicator","Colors","FlatButton","Home","navigation","code","getParam","login","setLogin","token","setToken","isLoading","setIsLoading","POST_body","getUserInfoFrom42API","user_id","get_url","Promise","resolve","reject","fetch","method","headers","Headers","response","json","console","error","getUserIdFrom42API","filter","toLowerCase","trim","getTokenFrom42API","body","JSON","stringify","access_token","log","getTokenInfo","verifyToken","check","new_token","handleSubmit","user","id","info","navigate","userInfo","require","styles","background","container","textInput","StyleSheet","create","width","height","marginTop","marginBottom","backgroundColor"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { StyleSheet, View, ImageBackground, ImageBackgroundBase} from 'react-native';\nimport { globalStyles } from '../styles/global';\nimport { MaterialIcons } from '@expo/vector-icons';\nimport Card from '../shared/card';\nimport { TextInput, ActivityIndicator, Colors } from 'react-native-paper';\nimport FlatButton from '../shared/button.js';\n\nexport default function Home({ navigation }) {\n  const code = navigation.getParam('code');\n  const [login, setLogin] = useState('');\n  const [token, setToken] = useState('')\n  const [isLoading, setIsLoading] = useState(false)\n  const POST_body = {\n    'grant_type': 'authorization_code',\n    'client_id': 'c0d296f87ad3d2fd9c1980da5f055fb4ee7fae41830be1f5d6985bea22b84a36',\n    'client_secret': '4631186c7cc1a5c7d206310ab2c04af3168cc0f41789173160cebaab61588233',\n    'code': code,\n    'redirect_uri': 'exp://10.18.205.228:19000',\n  }\n\n  const getUserInfoFrom42API = async (token, user_id) => {\n    const get_url = 'https://api.intra.42.fr/v2/users/' + user_id\n\n    return new Promise(async (resolve, reject) => {\n      try {\n        let response = await fetch(get_url, {\n          method: \"GET\",\n          headers: new Headers({\n            'Authorization': 'Bearer '+ token, \n            'Content-Type': 'application/json'\n          }), \n        });\n        let json = await response.json();\n        resolve(json);\n      } catch (error) {\n        console.error(error);\n        reject(error)\n      }\n      });\n    };\n\n  const getUserIdFrom42API = async (token) => {\n    let filter = login.toLowerCase()\n    filter = filter.trim() \n    const get_url = 'https://api.intra.42.fr/v2/users?filter[login]=' + filter\n\n    return new Promise(async (resolve, reject) => {\n      try {\n        let response = await fetch(get_url, {\n          method: \"GET\",\n          headers: new Headers({\n            'Authorization': 'Bearer '+ token, \n            'Content-Type': 'application/json'\n          }), \n        });\n        let json = await response.json();\n        resolve(json);\n      } catch (error) {\n        console.error(error);\n        reject(error)\n      }\n      });\n    };\n\n    const getTokenFrom42API = () => {\n      return new Promise(async (resolve, reject) => {\n        try {\n          let response = await fetch('https://api.intra.42.fr/oauth/token', {\n            method: \"POST\",\n            body: JSON.stringify(POST_body),\n            headers: {\n              'Content-Type': 'application/json'\n            },\n          });\n          let json = await response.json()\n          resolve (json.access_token)\n        } catch (err){\n          console.log(err)\n          reject(err)\n        }\n      });\n    }\n\n  const getTokenInfo = (token) => {\n    return new Promise(async (resolve, reject) => {\n      try {\n        let response = await fetch('https://api.intra.42.fr/oauth/token/info', {\n          method: \"GET\",\n          headers: new Headers({\n            'Authorization': 'Bearer '+ token, \n            'Content-Type': 'application/json'\n          }), \n        });\n        let json = await response.json();\n        console.log(json)\n        resolve(json);\n      } catch (error) {\n        console.error(error);\n        reject(error)\n      }\n    });\n  };\n\n  const verifyToken = () => {\n    return new Promise(async (resolve, reject) => {\n      try {\n        if (token != '') {\n          console.log(token)\n          const check = await getTokenInfo(token);\n          resolve(token)\n        }\n        else {\n          const new_token = await getTokenFrom42API()\n          setToken(new_token);\n          resolve(new_token)\n        }\n        resolve (0)\n      } catch (err) {\n        console.log(err)\n        reject (-1)\n      }\n    })\n  }\n\n  const handleSubmit = async () => {\n    if (login != '') {\n      setIsLoading(true)\n      const token = await verifyToken()\n      const user = await getUserIdFrom42API(token)\n      const user_id = user[0].id\n      console.log(isLoading);\n      const info = await getUserInfoFrom42API(token, user_id)\n      setIsLoading(false)\n      navigation.navigate('ReviewDetails', {login: login, userInfo: info})\n    }\n  }\n\n  return (\n    <ImageBackground source={require('../assets/background.jpeg')} style={styles.background}>\n      <View style={globalStyles.container}>\n        <TextInput\n          label=\"Login\"\n          onChangeText={setLogin}\n          value={login}\n          style={styles.textInput}\n        />\n      <FlatButton onPress={handleSubmit} text='submit' />\n      </View>\n    </ImageBackground>\n  );\n}\n\nconst styles = StyleSheet.create({\n  background: {\n    width: '100%',\n    height: '100%',\n  },\n  textInput: {     \n    marginTop: 150,\n    marginBottom:10, \n    backgroundColor: \"#E7F0FE\",\n  },\n});"]},"metadata":{},"sourceType":"module"}